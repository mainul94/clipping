{"version":3,"sources":["notification.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"notification.js","sourcesContent":["/**\n * Created by root on 11/27/16.\n */\nclass Notification {\n\tconstructor(args) {\n\t\tthis.args =args || {};\n\t\tthis.$wrapper = $(typeof this.args.parent !==\"undefined\" ?this.args.parent:'#notification');\n\t\tthis.make();\n\t}\n\tmake() {\n\t\tthis.$wrapper.html(null);\n\t\tthis.$notifyLink = $('<a href=\"javascript:;\" class=\"dropdown-toggle info-number\"' +\n\t\t\t' data-toggle=\"dropdown\" aria-expanded=\"false\"> <i class=\"fa fa-envelope-o\"></i>' +\n\t\t\t'<span class=\"badge bg-green\">0</span>' +\n\t\t\t'</a>').appendTo(this.$wrapper);\n\t\tthis.$count_html = this.$notifyLink.find('span.badge');\n\t\tthis.make_list_wrapper();\n\t}\n\tmake_list_wrapper(){\n\t\tvar me = this;\n\t\tthis.$listWrapper = $('<ul class=\"dropdown-menu list-unstyled msg_list\" role=\"menu\">').appendTo(this.$wrapper);\n\t\tthis.$mark_all_read_all = $('<a>Mark as all Read</a>').appendTo(this.$listWrapper).on('click',function () {\n\t\t\tme.ajax_nofication_update({\n\t\t\t\tall: true\n\t\t\t}, function (r) {\n\t\t\t\tme.set_count_value(0);\n\t\t\t\tme.$listWrapper.find('li.unread').removeClass('unread')\n\t\t\t});\n\t\t});\n\t\tthis.get_notifications();\n\t}\n\tget_notifications(){\n\t\tvar me = this;\n\t\tthis.call_notifications(function (r) {\n\t\t\tfor (var i in r) {\n\t\t\t\t$.extend(r[i],r[i].data);\n\t\t\t\tdelete r[i].data\n\t\t\t\tme.add_notification(r[i])\n\t\t\t}\n\t\t});\n\t}\n\tadd_notification(data, sound){\n\t\tvar me = this;\n\t\t// Add Item\n\t\tthis.$itemWrapper = $('<li>').prependTo(this.$listWrapper).attr('data-id',data.id);\n\t\tif (!data.read_at) {\n\t\t\tthis.$itemWrapper.addClass('unread');\n\t\t\t// Update counter\n\t\t\tthis.update_count();\n\t\t}\n\t\tthis.$item = $('<a>').appendTo(this.$itemWrapper).addClass('item');\n\t\tthis.$item.attr('href',data.action || '#');\n\t\tif (data.avatar) {\n\t\t\tthis.$item.append('<span class=\"user-profile\"><img src=\"'+data.avatar+'\" alt=\"Avatar\" /></span>')\n\t\t}\n\t\tthis.$item.append('<span>'+(data.title  || \"\")+'</span>'+\n\t\t\t'<p>'+(data.message || \"\") + (data.image?'<span class=\"image\"><img class=\" pull-right\" src=\"'+data.image+'\" alt=\"Image\" /></span>':'')+\n\t\t\t'</p>');\n\t\tthis.$item.attr('title', 'Go to Details');\n\n\t\tthis.$item.on('click', function () {\n\t\t\tvar e = $(this).siblings('a.mark-as-read');\n\t\t\tme.set_as_mark(e);\n\t\t});\n\n\t\tthis.$markAsRead = $('<a>').addClass('mark-as-read').appendTo(this.$itemWrapper);\n\t\tif (!data.read_at) {\n\t\t\tthis.$markAsRead.html('<i class=\"fa fa-circle\" aria-hidden=\"true\"></i>').attr('title','Mark as Read')\n\t\t}else {\n\t\t\tthis.$markAsRead.html('<i class=\"fa fa-circle-o\" aria-hidden=\"true\"></i>').attr('title','Mark as Unread')\n\t\t}\n\t\tthis.$markAsRead.on('click', function () {\n\t\t\tme.set_as_mark(this);\n\t\t\treturn false\n\t\t});\n\t\t// Sound Setup\n\t\tif (sound) {\n\t\t\tthis.play_sound()\n\t\t}\n\t}\n\tplay_sound(){\n\t\tvar $audio = $('#sound-email')[0];\n\t\tif ($audio.paused) {\n\t\t\t$audio.play();\n\t\t}else{\n\t\t\t$audio.currentTime = 0\n\t\t}\n\t}\n\tupdate_count(plus){\n\t\tvar value = parseInt(this.$count_html.html()) || 0;\n\t\tif (typeof plus !== \"undefined\") {\n\t\t\tvalue += plus\n\t\t}else\n\t\t{\n\t\t\tvalue++\n\t\t}\n\t\tthis.set_count_value(value)\n\t}\n\tset_count_value(value){\n\t\tif (value > 0) {\n\t\t\tthis.$count_html.removeClass('bg-green').addClass('bg-red')\n\t\t}else\n\t\t{\n\t\t\tthis.$count_html.addClass('bg-green').removeClass('bg-red')\n\t\t}\n\t\tthis.$count_html.html(value)\n\t}\n\tset_as_mark(e) {\n\t\tvar $itemWrapper = $(e).closest('li');\n\t\tif ($itemWrapper.hasClass('unread')) {\n\t\t\t$itemWrapper.removeClass('unread');\n\t\t\t$(e).attr('title','Mark as Unread').children('i.fa').removeClass('fa-circle').addClass('fa-circle-o');\n\t\t\tthis.update_count(-1);\n\t\t\tthis.ajax_nofication_update({\n\t\t\t\tid:$itemWrapper.attr('data-id')\n\t\t\t})\n\t\t}else {\n\t\t\t$itemWrapper.addClass('unread');\n\t\t\t$(e).attr('title','Mark as Read').children('i.fa').removeClass('fa-circle-o').addClass('fa-circle');\n\t\t\tthis.update_count();\n\t\t\tthis.ajax_nofication_update({\n\t\t\t\tid:$itemWrapper.attr('data-id'),\n\t\t\t\tmark_as:'Unread'\n\t\t\t})\n\t\t}\n\t}\n\tajax_nofication_update(data,callback) {\n\t\t$.ajax({\n\t\t\turl: '/notification',\n\t\t\tmethod:'POST',\n\t\t\tdata:data,\n\t\t\tsuccess:function (r) {\n\t\t\t\tconsole.log(r);\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(r)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tcall_notifications(callback) {\n\t\t$.ajax({\n\t\t\turl: '/notification',\n\t\t\tmethod:'GET',\n\t\t\tsuccess:function (r) {\n\t\t\t\tcallback(r);\n\t\t\t}\n\t\t});\n\t}\n\n}\nWindow.Notify = new Notification();"],"sourceRoot":"/source/"}